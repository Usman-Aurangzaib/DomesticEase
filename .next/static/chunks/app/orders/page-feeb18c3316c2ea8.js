(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1569],{2106:function(e,r,n){Promise.resolve().then(n.bind(n,3079))},2966:function(e,r,n){"use strict";n.d(r,{AU:function(){return l},Cs:function(){return o},LU:function(){return c},LV:function(){return d},Wv:function(){return t},co:function(){return i},zk:function(){return s}}),n(5355);var a=n(3472),i=(0,a.$)("87811bda8aab4f2c40c29da1aea7294596397243"),t=(0,a.$)("2b5f27bb77a493a536153c35bc92da67448bbf00"),d=(0,a.$)("604a5f53a386e7d884ceb4e637d9db4dde083582"),l=(0,a.$)("cebd14fc41c69c7d1b4b0d283ed367f82ad15ead"),s=(0,a.$)("aa60c369216bcb2edf713d1d760271767fc5a6b6"),c=(0,a.$)("108866074a754ba62450c20513e6d7aa9f0ae0d5"),o=(0,a.$)("0e2da7323e643dc8502d779a9be0ee215a5adedb")},8341:function(e,r,n){"use strict";n.d(r,{EA:function(){return i},K3:function(){return s},Mm:function(){return l},N_:function(){return t},_r:function(){return d}}),n(5355);var a=n(3472),i=(0,a.$)("6d757ae541fc0bbdda1c770b8d762a7ba13c8c56"),t=(0,a.$)("6a035b8edf0379b08192112a9a7ab36bc6203901"),d=(0,a.$)("dbc95576c41cfdf6449f327f8376ab30081dfa7c"),l=(0,a.$)("d3404bb93b9a4209d33db081d3774c9915eb1407"),s=(0,a.$)("09a62f06f82ea7d68ac63d7000afb8be15a907d7")},6518:function(e,r,n){"use strict";n.d(r,{AW:function(){return o},FA:function(){return u},Nq:function(){return c},PR:function(){return l},Re:function(){return d},bG:function(){return s},h8:function(){return i},r4:function(){return t}}),n(5355);var a=n(3472),i=(0,a.$)("9c3fff7bc34ea049ee987a3faad47491f6dcc742"),t=(0,a.$)("0f4d132821da063e73dee58ac0271c6b416dbe08"),d=(0,a.$)("2727ff5f424dc69ed443f01d95876fa2ea974c6d"),l=(0,a.$)("830a08f0b4898aa4d63fb94229055f2fce3e3f71"),s=(0,a.$)("e80969a57efceefee6a8a65908e1e314fe49a2a0"),c=(0,a.$)("ae483d5d3c1e2e20ae95a2933fab40df31f7512a"),o=(0,a.$)("a8dbe559b9e3e82e687aabcfe7c2bab9f020568c"),u=(0,a.$)("59975b62b53c5f40ad91cc17f309d881c82b0209")},5402:function(e,r,n){"use strict";n.d(r,{M:function(){return l},a:function(){return s}});var a=n(7437),i=n(7907),t=n(2265);let d=(0,t.createContext)(null),l=e=>{let{children:r}=e,[n,l]=(0,t.useState)(""),s=(0,i.usePathname)(),c=(0,i.useRouter)();return(0,t.useEffect)(()=>{let e=localStorage.getItem("domestic-user");e?l(e):("/book"===s||"/profile"===s||"/dashboard"===s)&&c.push("/")},[]),(0,a.jsx)(d.Provider,{value:{user:n,setUser:l,logout:()=>{localStorage.removeItem("domestic-user"),l(""),c.push("/")}},children:r})},s=()=>{let e=(0,t.useContext)(d);if(!e)throw Error("useUser must be used within a UserWrapper");return e}},3079:function(e,r,n){"use strict";n.r(r),n.d(r,{default:function(){return W}});var a=n(7437),i=n(4285),t=n(7895),d=n(9623),l=n(7727),s=n(8542),c=n(2540),o=n(6956),u=n(5426),f=n(2973),h=n(8633),g=n(5402),x=n(4642),b=n(2966),m=n(2265),j=n(8341),p=n(6518),v=n(4741),k=n(209),w=n(4873),y=n(6129),T=n(129),S=n(653),C=n(2250),z=n(6632),$=n(2207),_=n(3738),D=n(3518),P=n(1957),A=n(7082),O=n(568),N=n(7907),F=function(e){let{order:r,setNull:n}=e,l=(0,A.NL)(),s=(0,N.useRouter)(),{data:c}=(0,x.a)({queryKey:["reviews",null==r?void 0:r.worker],queryFn:async()=>(0,j._r)(r.worker)}),[o,u]=(0,m.useState)(""),[f,g]=(0,m.useState)(0),[F,W]=(0,m.useState)(""),{data:E,isLoading:I}=(0,x.a)({queryKey:["worker",null==r?void 0:r.worker],queryFn:async()=>(0,p.bG)(r.worker)}),{mutate:R,isPending:q}=(0,O.D)({mutationFn:async e=>{console.log({order:r});let n=await (0,b.Cs)({worker:r.worker,dateTime:r.dateTime},e);return l.invalidateQueries({queryKey:["orders","worker"]}),s.refresh(),n}}),{mutate:Y}=(0,O.D)({mutationFn:async()=>{let e=await fetch("/api/checkout?orderId=".concat(r._id)),n=await e.json();console.log({res:n}),s.push(n.session.url)}}),L=(0,v.p)(),{mutate:U,isPending:K}=(0,O.D)({mutationFn:async e=>{let n=await (0,j.N_)({image:r.image,service:r.service,worker:r.worker,user:r.email,rating:f,videoName:e,review:o});return console.log({res:n}),n},onSuccess:()=>{L({title:"Review added",status:"success",duration:9e3,isClosable:!0})}});if(console.log({worker:E,isLoading:I}),!r)return(0,a.jsx)(a.Fragment,{});let M=async e=>{var r,n,a,i,t;if(e.preventDefault(),(null===(a=e.target.file)||void 0===a?void 0:null===(n=a.files)||void 0===n?void 0:null===(r=n[0])||void 0===r?void 0:r.size)>8388608){L({title:"Image size should be less than 8MB",status:"error",duration:9e3,isClosable:!0});return}let d="";if(null===(t=e.target.file)||void 0===t?void 0:null===(i=t.files)||void 0===i?void 0:i.length){let r=new FormData;r.append("file",e.target.file.files[0]);let n=await fetch("/api/upload-image",{method:"POST",body:r});d=(await n.json()).name}U(d)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(k.u_,{size:"xl",onClose:n,isOpen:!0,isCentered:!0,children:[(0,a.jsx)(w.Z,{}),(0,a.jsxs)(y.h,{children:[(0,a.jsx)(T.x,{children:"Order"}),(0,a.jsx)(S.o,{}),(0,a.jsxs)(C.f,{children:[I?(0,a.jsx)(h.$,{}):(0,a.jsxs)(a.Fragment,{children:[E.image&&(0,a.jsx)("img",{src:"/api/get-image/".concat(E.image),alt:"",width:200,height:200,style:{margin:"auto",objectFit:"cover",borderRadius:"50%"}}),(0,a.jsxs)(t.x,{fontWeight:"bold",fontSize:"large",marginY:4,children:["Worker Name: ",E.name]})]}),(0,a.jsxs)(i.k,{background:"gray.100",padding:2,borderRadius:4,gap:2,flexDir:"column",children:[(0,a.jsx)(t.x,{fontSize:"large",fontWeight:"bold",children:"Basic Information"}),(0,a.jsxs)(t.x,{children:["Order Name: ",r.name]}),(0,a.jsxs)(t.x,{children:["Order Status: ",r.status]}),(0,a.jsxs)(t.x,{children:["Order Phone: ",r.phone]}),(0,a.jsxs)(t.x,{children:["Order Date: ",r.dateTime.split("T")[0]]}),(0,a.jsxs)(t.x,{children:["Order Time: ",r.dateTime.split("T")[1]]})]}),(0,a.jsxs)(i.k,{background:"gray.100",padding:2,borderRadius:4,gap:2,flexDir:"column",marginY:2,children:[(0,a.jsx)(t.x,{fontSize:"large",fontWeight:"bold",children:"Additional Details"}),(0,a.jsxs)("p",{children:["Order Worker: ",r.worker]}),(0,a.jsxs)("p",{children:["Order Service: ",r.service]}),(0,a.jsxs)("p",{children:["Order Extra: ",r.extra]}),(0,a.jsxs)("p",{children:["Order Paid: ",r.paid?"PAID":"NOT PAID"]})]}),r.paid?(0,a.jsx)(a.Fragment,{}):(0,a.jsx)(d.z,{onClick:()=>Y(),marginTop:2,w:"100%",colorScheme:"blue",children:"Pay"}),"pending"===r.status&&(0,a.jsxs)(i.k,{gap:2,children:[(0,a.jsx)(d.z,{onClick:()=>R("completed"),isLoading:q,marginTop:1,w:"100%",colorScheme:"teal",children:"Complete"}),(0,a.jsx)(d.z,{onClick:()=>R("cancelled"),isLoading:q,marginTop:1,w:"100%",colorScheme:"red",children:"Cancel"})]}),(0,a.jsx)(z.i,{marginTop:2}),"completed"===r.status&&(0,a.jsx)("form",{onSubmit:M,children:(0,a.jsxs)(i.k,{flexDir:"column",gap:2,children:[(0,a.jsx)(t.x,{fontSize:"large",fontWeight:"bold",children:"Add a review"}),(0,a.jsx)($.g,{value:o,onChange:e=>u(e.target.value),placeholder:"Enter review",marginTop:2,w:"100%"}),(0,a.jsxs)(_.P,{value:f,onChange:e=>g(parseInt(e.target.value)),children:[(0,a.jsx)("option",{value:1,children:"1 star"}),(0,a.jsx)("option",{value:2,children:"2 stars"}),(0,a.jsx)("option",{value:3,children:"3 stars"}),(0,a.jsx)("option",{value:4,children:"4 stars"}),(0,a.jsx)("option",{value:5,children:"5 stars"})]}),(0,a.jsx)("br",{}),(0,a.jsx)(t.x,{children:"Add attachment"}),(0,a.jsx)(D.I,{width:500,type:"file",name:"file",accept:"image/*",onChange:e=>W(e.target.value)}),(0,a.jsx)(d.z,{isLoading:K,type:"submit",children:"Submit review"})]})}),(0,a.jsxs)(i.k,{gap:2,flexDir:"column",marginTop:2,children:[(0,a.jsx)(t.x,{fontSize:"large",fontWeight:"bold",children:"Reviews"}),null==c?void 0:c.map(e=>(0,a.jsxs)(i.k,{background:"gray.100",padding:2,borderRadius:4,gap:2,flexDir:"column",marginY:2,children:[(0,a.jsx)(t.x,{fontSize:"large",fontWeight:"bold",children:e.user}),(0,a.jsx)(t.x,{children:e.review})]},e._id))]})]}),(0,a.jsx)(P.m,{children:(0,a.jsx)(d.z,{w:"100%",onClick:n,children:"Close"})})]})]})})},W=()=>{let{user:e}=(0,g.a)(),[r,n]=(0,m.useState)(null),{data:j,isLoading:p}=(0,x.a)({queryKey:["orders",e],queryFn:async()=>(0,b.AU)(e)}),[v,k]=(0,m.useState)("all"),w="all"===v?j:null==j?void 0:j.filter(e=>"paid"===v?e.paid:"not-paid"===v?!e.paid:"pending"===v?"pending"===e.status:"completed"===v?"completed"===e.status:void 0);return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(F,{order:r,setNull:()=>n(null)}),(0,a.jsxs)(i.k,{flexDir:"column",w:"100%",paddingX:{base:4,md:8},marginY:10,children:[(0,a.jsx)(t.x,{fontSize:{base:"xl",md:"xx-large"},fontWeight:"800",textAlign:{base:"center",md:"left"},children:"Orders"}),(0,a.jsxs)(i.k,{w:"100%",gap:{base:2,md:4},flexWrap:"wrap",marginY:4,children:[(0,a.jsx)(d.z,{background:"all"===v?"green.300":"gray.200",flex:1,onClick:()=>k("all"),_hover:{background:"green.300"},children:"All"}),(0,a.jsx)(d.z,{background:"paid"===v?"green.300":"gray.200",flex:1,onClick:()=>k("paid"),_hover:{background:"green.300"},children:"Paid"}),(0,a.jsx)(d.z,{background:"not-paid"===v?"green.300":"gray.200",flex:1,onClick:()=>k("not-paid"),_hover:{background:"green.300"},children:"Not Paid"}),(0,a.jsx)(d.z,{flex:1,onClick:()=>k("pending"),background:"pending"===v?"green.300":"gray.200",_hover:{background:"green.300"},children:"Pending"}),(0,a.jsx)(d.z,{flex:1,onClick:()=>k("completed"),background:"completed"===v?"green.300":"gray.200",_hover:{background:"green.300"},children:"Completed"})]}),(0,a.jsx)(i.k,{flexDirection:"column",gap:2,width:"100%",marginY:10,overflowX:"auto",children:(0,a.jsxs)(l.i,{variant:"simple",size:"md",width:"full",children:[(0,a.jsx)(s.h,{children:(0,a.jsxs)(c.Tr,{children:[(0,a.jsx)(o.Th,{children:"NAME"}),(0,a.jsx)(o.Th,{children:"ADDRESS"}),(0,a.jsx)(o.Th,{children:"CITY"}),(0,a.jsx)(o.Th,{children:"PAYMENT STATUS"})]})}),(0,a.jsx)(u.p,{children:p?(0,a.jsx)(c.Tr,{children:(0,a.jsx)(f.Td,{colSpan:4,children:(0,a.jsx)(h.$,{size:"xl"})})}):null==w?void 0:w.map(e=>(0,a.jsxs)(c.Tr,{cursor:"pointer",onClick:()=>n(e),_hover:{bg:"gray.100"},children:[(0,a.jsx)(f.Td,{children:e.name}),(0,a.jsx)(f.Td,{children:e.address}),(0,a.jsx)(f.Td,{children:e.city}),(0,a.jsx)(f.Td,{children:e.paid?"Paid":"Not Paid"})]},e.id))})]})})]})]}):(0,a.jsx)(i.k,{justifyContent:"center",alignItems:"center",height:"100vh",children:(0,a.jsx)(t.x,{fontSize:{base:"lg",md:"xx-large"},fontWeight:"800",textAlign:"center",marginX:4,children:"Only logged in users can view this page"})})}}},function(e){e.O(0,[1571,8633,8618,4642,3104,8504,3232,6891,2971,8069,1744],function(){return e(e.s=2106)}),_N_E=e.O()}]);