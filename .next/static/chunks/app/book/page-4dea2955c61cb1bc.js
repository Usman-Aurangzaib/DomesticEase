(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3886],{7663:function(e,t,a){Promise.resolve().then(a.bind(a,1481))},2966:function(e,t,a){"use strict";a.d(t,{AU:function(){return o},Cs:function(){return u},LU:function(){return s},LV:function(){return i},Wv:function(){return l},co:function(){return r},zk:function(){return c}}),a(5355);var n=a(3472),r=(0,n.$)("87811bda8aab4f2c40c29da1aea7294596397243"),l=(0,n.$)("2b5f27bb77a493a536153c35bc92da67448bbf00"),i=(0,n.$)("604a5f53a386e7d884ceb4e637d9db4dde083582"),o=(0,n.$)("cebd14fc41c69c7d1b4b0d283ed367f82ad15ead"),c=(0,n.$)("aa60c369216bcb2edf713d1d760271767fc5a6b6"),s=(0,n.$)("108866074a754ba62450c20513e6d7aa9f0ae0d5"),u=(0,n.$)("0e2da7323e643dc8502d779a9be0ee215a5adedb")},8045:function(e,t,a){"use strict";a.d(t,{T:function(){return n}});let n=[{label:"Electrician services",value:"electrician"},{label:"Plumber services",value:"plumber"},{label:"Home cleaning services",value:"home_cleaning"},{label:"Car cleaning and maintenance services",value:"car_cleaning"},{label:"Pest control services",value:"pest_control"},{label:"Carpentry services",value:"carpentry"}]},6518:function(e,t,a){"use strict";a.d(t,{AW:function(){return u},FA:function(){return d},Nq:function(){return s},PR:function(){return o},Re:function(){return i},bG:function(){return c},h8:function(){return r},r4:function(){return l}}),a(5355);var n=a(3472),r=(0,n.$)("9c3fff7bc34ea049ee987a3faad47491f6dcc742"),l=(0,n.$)("0f4d132821da063e73dee58ac0271c6b416dbe08"),i=(0,n.$)("2727ff5f424dc69ed443f01d95876fa2ea974c6d"),o=(0,n.$)("830a08f0b4898aa4d63fb94229055f2fce3e3f71"),c=(0,n.$)("e80969a57efceefee6a8a65908e1e314fe49a2a0"),s=(0,n.$)("ae483d5d3c1e2e20ae95a2933fab40df31f7512a"),u=(0,n.$)("a8dbe559b9e3e82e687aabcfe7c2bab9f020568c"),d=(0,n.$)("59975b62b53c5f40ad91cc17f309d881c82b0209")},1481:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return N}});var n=a(7437),r=a(2265),l=a(2782),i=a.n(l),o=a(5941),c=a(4741),s=a(4285),u=a(8633),d=a(7895),f=a(3518),h=a(3738),g=a(2207),m=a(9623),b=a(2966),v=a(209),x=a(4873),p=a(6129),j=a(129),w=a(653),y=a(2250),S=a(1957),C=e=>{let{isOpen:t,onOpen:a,onClose:r,text:l,title:i=""}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(v.u_,{isOpen:t,onClose:r,children:[(0,n.jsx)(x.Z,{}),(0,n.jsxs)(p.h,{children:[(0,n.jsx)(j.x,{children:i}),(0,n.jsx)(w.o,{}),(0,n.jsx)(y.f,{}),(0,n.jsx)(d.x,{textAlign:"center",fontSize:"medium",children:l}),(0,n.jsx)(S.m,{children:(0,n.jsx)(m.z,{colorScheme:"blue",mr:3,onClick:r,children:"Close"})})]})]})})},k=a(5402),I=a(8045),z=a(7907),P=a(4642),$=a(6518);i().accessToken="pk.eyJ1Ijoid2luZXBpbmV6IiwiYSI6ImNsdXZlYzNoOTAyaHAybG55bGw2ZDJ1OTgifQ.58CX4i5rlZ3uYYPTr_cqWQ";let T=["Enter your address","Enter your information and select a date","Select a service"];var N=()=>{let{user:e}=(0,k.a)(),{data:t,isLoading:a}=(0,P.a)({queryKey:["user",e],queryFn:()=>(0,$.bG)(e)}),[l,v]=(0,r.useState)(0),[x,p]=(0,r.useState)(null),[j,w]=(0,r.useState)(""),[y,S]=(0,r.useState)(""),[N,D]=(0,r.useState)(""),[_,A]=(0,r.useState)(""),[E,O]=(0,r.useState)(""),[L,R]=(0,r.useState)(""),[W,q]=(0,r.useState)(null),[Y,G]=(0,r.useState)(null),Z=(0,r.useRef)(null),F=(0,r.useRef)(null),[B,H]=(0,r.useState)(""),[M,U]=(0,r.useState)(""),[X,J]=(0,r.useState)(""),[V,Q]=(0,r.useState)(!1),K=e=>{p(e),console.log(e),ea([e.lng,e.lat])},[ee,et]=(0,r.useState)("No worker available for this service"),ea=e=>{if(!W)return;Z.current&&Z.current.remove();let t=new(i()).Marker().setLngLat(e).addTo(W);Z.current=t,G(t),W.resize()};(0,r.useEffect)(()=>(W?navigator.geolocation.getCurrentPosition(e=>{let{latitude:t,longitude:a}=e.coords;ea([a,t]),W.flyTo({center:[a,t],zoom:14}),W.on("click",e=>{let{lng:t,lat:a}=e.lngLat;K({lng:t,lat:a}),ea([t,a])})},e=>{console.error("Geolocation error:",e)},{enableHighAccuracy:!0}):(e=>{let{setMap:t,mapContainerRef:a}=e;navigator.geolocation.getCurrentPosition(e=>{let{latitude:n,longitude:r}=e.coords;if(a.current){let e=new(i()).Map({container:a.current,style:"mapbox://styles/mapbox/streets-v11",center:[r,n],zoom:9});e.on("load",()=>{t(e),e.resize()}),t(e),e.resize()}},e=>{console.error("Geolocation error:",e)},{enableHighAccuracy:!0})})({setMap:q,mapContainerRef:F}),()=>{W&&W.remove()}),[W,a]);let{isOpen:en,onOpen:er,onClose:el}=(0,o.q)(),ei=(0,z.useRouter)(),eo=async t=>{var a,n,r,i,o;if(t.preventDefault(),2!==l)return;if(!j||!y||!L){O("Please fill out all fields");return}if(!N){O("Please select a service");return}if(Q(!0),(null===(r=t.target.file)||void 0===r?void 0:null===(n=r.files)||void 0===n?void 0:null===(a=n[0])||void 0===a?void 0:a.size)>8388608){O("Image size should be less than 8MB"),Q(!1);return}let c="";if(null===(o=t.target.file)||void 0===o?void 0:null===(i=o.files)||void 0===i?void 0:i.length){let e=new FormData;e.append("file",t.target.file.files[0]);let a=await fetch("/api/upload-image",{method:"POST",body:e});c=(await a.json()).name}console.log(typeof L,L);let s=await (0,b.Wv)(N,L.split("T")[0]);if(console.log({worker:s}),!s.email){et("No worker available for this service"),er(),Q(!1);return}await fetch("/api/new-order-mail",{method:"POST",body:JSON.stringify({email:s.email})});let u=await (0,b.LV)({name:j,phone:y,address:B,city:M,service:N,email:e,image:c,date:L.split("T")[0],worker:s.email,dateTime:L,extra:X,location:x,paid:!1});Q(!1),console.log({order:u}),et("Request submitted successfully"),er(),ei.push("/")},ec=(0,c.p)();return a?(0,n.jsx)(s.k,{direction:"column",width:"100%",justifyContent:"center",alignItems:"center",marginY:10,paddingBottom:64,children:(0,n.jsx)(u.$,{size:"xl"})}):e?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C,{isOpen:en,onClose:el,text:ee}),(0,n.jsx)("form",{onSubmit:eo,style:{width:"100%",display:"flex",justifyContent:"center"},children:(0,n.jsxs)(s.k,{gap:6,marginY:10,justifyContent:"center",alignItems:"center",flexDirection:"column",boxShadow:"dark-lg",padding:8,borderRadius:8,maxW:600,width:"100%",mx:4,children:[(0,n.jsxs)(d.x,{fontSize:"x-large",fontWeight:"bold",children:["Step ",l+1,": ",T[l]]}),0===l&&(0,n.jsxs)(s.k,{width:"100%",gap:2,justifyContent:"center",alignItems:"center",flexDirection:"column",children:[(0,n.jsx)(f.I,{width:"100%",type:"text",placeholder:"Address",onChange:e=>H(e.target.value)}),(0,n.jsx)(f.I,{width:"100%",type:"text",placeholder:"City",onChange:e=>U(e.target.value)}),(0,n.jsx)("link",{href:"https://api.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css",rel:"stylesheet"}),(0,n.jsx)("div",{ref:F,className:"map-container",style:{width:"100%",height:"400px",position:"relative",overflow:"hidden"}})]}),1===l&&(0,n.jsxs)(s.k,{width:"100%",gap:2,justifyContent:"center",alignItems:"center",flexDirection:"column",children:[(0,n.jsx)(f.I,{width:"100%",type:"text",placeholder:"Name",value:j,onChange:e=>{e.target.value.length>20||e.target.value.match(/[^a-zA-Z\s]/)||w(e.target.value)}}),(0,n.jsx)(f.I,{width:"100%",type:"number",placeholder:"Phone",maxLength:12,value:y,onChange:e=>{e.target.value.length>12||e.target.value.match(/[^0-9]/)||S(e.target.value)}}),(0,n.jsx)(f.I,{width:"100%",value:L,type:"datetime-local",placeholder:"Date and Time",onChange:e=>{new Date(e.target.value)>=new Date?R(e.target.value):ec({title:"Invalid Date",description:"Please select a date in the future",status:"error",duration:5e3,isClosable:!0})}})]}),2===l&&(0,n.jsxs)(s.k,{width:"100%",gap:2,justifyContent:"center",alignItems:"center",flexDirection:"column",children:[(0,n.jsx)(h.P,{value:N,onChange:e=>D(e.target.value),width:"100%",placeholder:"Select service",children:I.T.map(e=>(0,n.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,n.jsx)(g.g,{width:"100%",placeholder:"Extra information",onChange:e=>J(e.target.value)}),(0,n.jsx)(f.I,{width:"100%",type:"file",name:"file",accept:"video/*",onChange:e=>A(e.target.value)})]}),(0,n.jsx)(d.x,{color:"red",children:E}),2===l&&(0,n.jsx)(m.z,{isLoading:V,type:"submit",width:"100%",colorScheme:"green",children:"Submit request"}),2!==l&&(0,n.jsx)(m.z,{onClick:()=>{2===l||v(l+1)},width:"100%",colorScheme:"teal",children:"Next"}),0!==l&&(0,n.jsx)(m.z,{onClick:()=>{0!==l&&v(l-1)},width:"100%",colorScheme:"teal",children:"Back"})]})})]}):(0,n.jsx)(s.k,{children:(0,n.jsx)(d.x,{fontSize:"xx-large",fontWeight:"800",marginY:10,marginX:"auto",children:"Only logged in users can view this page"})})}},5402:function(e,t,a){"use strict";a.d(t,{M:function(){return o},a:function(){return c}});var n=a(7437),r=a(7907),l=a(2265);let i=(0,l.createContext)(null),o=e=>{let{children:t}=e,[a,o]=(0,l.useState)(""),c=(0,r.usePathname)(),s=(0,r.useRouter)();return(0,l.useEffect)(()=>{let e=localStorage.getItem("domestic-user");e?o(e):("/book"===c||"/profile"===c||"/dashboard"===c)&&s.push("/")},[]),(0,n.jsx)(i.Provider,{value:{user:a,setUser:o,logout:()=>{localStorage.removeItem("domestic-user"),o(""),s.push("/")}},children:t})},c=()=>{let e=(0,l.useContext)(i);if(!e)throw Error("useUser must be used within a UserWrapper");return e}}},function(e){e.O(0,[3415,1571,8633,8618,4642,3104,8504,3232,8896,2971,8069,1744],function(){return e(e.s=7663)}),_N_E=e.O()}]);